<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nemodian 2244-1 :: AI Code Editor Final</title>

<!-- Prism & js-beautify via CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
<!-- Added components for other common languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>


<!-- jQuery + GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<style>
:root{
  --baseline: 1.5em;
  --header-h: calc(var(--baseline) * 1.6);
  --status-h: var(--baseline);
  --footer-h: calc(var(--baseline) * 2);
  --font-size: 13px;
  --ln-width: 50px;
  --theme-bg: #3a3c31;
  --panel: #313328;
  --header-bg: #2e3026;
  --status-bg: #22241e;
  --accent: #4ac94a;
  --muted: #999966;
  --err: #a03333;
  --warn: #f0ad4e;
  --hover-blue: #3366a0;
}

/* Base */
html, body {height:100%; margin:0; padding:0; font-family:'Fira Code', monospace; font-size:var(--font-size); line-height:var(--baseline); background:var(--theme-bg); color:#f0f0e0;}
body {display:grid; grid-template-rows: var(--header-h) var(--status-h) 1fr var(--footer-h); overflow:hidden;}

/* Header */
header{grid-row:1; grid-column:1/-1; background:var(--header-bg); border-bottom:1px solid #22241e; display:flex; align-items:center; justify-content:space-between; padding:6px 12px;}
header .left {display:flex; gap:12px; align-items:center;}
header .right {display:flex; gap:8px; align-items:center;}

/* Button and Select Styles */
button, select {
    background:var(--err); 
    border:1px solid var(--err); 
    color:#f0f0e0; 
    padding:6px 8px; 
    cursor:pointer; 
    font-size:12px; 
    transition:all .2s; 
    border-radius:4px;
    font-family: inherit;
    line-height: 1; 
    height: 30px; 
    box-sizing: border-box;
}
button:hover{background:var(--hover-blue); border-color:var(--hover-blue);}

select {
    background: var(--status-bg); 
    border-color: var(--muted);
    color: #f0f0e0;
    min-width: 100px;
    appearance: none; 
    /* Custom down arrow using SVG data URI */
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23f0f0e0" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592c.859 0 1.319 1.013.753 1.659l-4.796 5.482c-.173.198-.456.198-.63 0z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 25px; 
}
select:hover {
    background: var(--hover-blue);
    border-color: var(--hover-blue);
}


/* Status */
#status-bar{grid-row:2; grid-column:1/-1; background:var(--status-bg); display:flex; justify-content:space-between; align-items:center; padding:4px 12px; font-size:12px;}
#status-bar.error{background:var(--err); color:#f0f0e0;}
#status-bar.warn{background:var(--warn); color:#3a3c31;}
#status-bar.success{background:var(--accent); color:#3a3c31;}

/* Editor stage */
#editor-stage{grid-row:3; grid-column:1/-1; display:grid; grid-template-columns:240px 1fr; background:var(--theme-bg); overflow:hidden;}
#left-panel{width:240px; background:var(--panel); border-right:1px solid #22241e; padding:10px; box-sizing:border-box; display:flex; flex-direction:column; gap:8px; transform:translateX(0);}
#left-panel.open{transform:translateX(0);}
#editor-outer{position:relative; overflow:hidden; background:transparent;}
#line-gutter{position:absolute; left:0; top:0; bottom:0; width:var(--ln-width); background:var(--panel); color:var(--muted); padding:10px 8px; box-sizing:border-box; overflow:auto; font-variant-numeric:tabular-nums;}
.highlighting{position:absolute; left:0; right:0; top:0; bottom:0; pointer-events:none; overflow:auto; padding:10px; box-sizing:border-box; white-space:pre-wrap; word-break:break-word; line-height:var(--baseline); padding-left: calc(var(--ln-width)+12px);}
.highlighting pre{margin:0;}
#editor{position:absolute; left:var(--ln-width); right:12px; top:0; bottom:0; padding:10px; margin:0; box-sizing:border-box; overflow:auto; background:transparent; color:transparent; caret-color:var(--accent); font-family:inherit; font-size:var(--font-size); line-height:var(--baseline); border:0; outline:0; resize:none; white-space:pre-wrap; word-break:break-word; z-index:20; padding-left:calc(var(--ln-width)+12px);}

/* Footer */
footer{grid-row:4; grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; padding:6px 12px; background:var(--header-bg); border-top:1px solid #22241e;}
#prompt-input{flex:1; margin-right:8px; padding:8px; background:var(--status-bg); border:1px solid var(--accent); color:#f0f0e0; font-family:inherit;}
.small{font-size:12px; padding:6px 8px;}
</style>
</head>
<body>

<header>
<div class="left">
  <button id="left-toggle" class="small">☰</button>
  <div style="font-weight:800;">Nemodian 2244-1 :: AI Editor</div>
</div>
<div class="right">
  <!-- Language Selector added here -->
  <select id="language-selector" class="small">
    <option value="javascript">JavaScript</option>
    <option value="markup">HTML / XML</option>
    <option value="css">CSS</option>
    <option value="python">Python</option>
    <option value="json">JSON</option>
  </select>

  <div id="ai-indicator" style="font-size:12px;color:#cfcfbd;">Local AI: probing…</div>
  <button id="open-file" class="small">Open</button>
  <button id="save-file" class="small">Save</button>
  <button id="save-as" class="small">Save As</button>
  <button id="run-local-ai" class="small">Run AI</button>
</div>
</header>

<div id="status-bar">
  <div id="file-meta">No File Loaded</div>
  <div id="editor-meta">Loading...</div>
</div>

<div id="editor-stage">
<aside id="left-panel">
  <button id="btn-undo" class="small">UNDO</button>
  <button id="btn-redo" class="small">REDO</button>
  <button id="btn-beautify" class="small">Beautify</button>
</aside>

<div id="editor-outer">
  <div id="line-gutter"></div>
  <div class="highlighting"><pre><code id="highlighted" class="language-javascript"></code></pre></div>
  <textarea id="editor">// Nemodian Final Editor Ready
console.log('Hello Nemodian');</textarea>
</div>
</div>

<footer>
<input id="prompt-input" placeholder="AI Prompt (Ctrl+Enter to run)">
<button id="send-button">SEND</button>
</footer>

<script>
// --- Core ---
let currentLang = 'javascript'; // Default language
const editor = $('#editor')[0];
const highlighted = $('#highlighted')[0];
const lineGutter = $('#line-gutter')[0];
const statusEditor = $('#editor-meta')[0];
const statusFile = $('#file-meta')[0];
const leftPanel = $('#left-panel');

function highlightAndRender(code, lang = currentLang){
  try{
    // Use the specific language object from Prism, falling back to C-like if not found
    const language = Prism.languages[lang] || Prism.languages.clike;
    highlighted.innerHTML = Prism.highlight(code, language, lang);
    highlighted.className = `language-${lang}`; // Crucial for Prism's CSS theming
  }catch(e){ 
    highlighted.textContent = code; 
    highlighted.className = `language-none`;
    console.error("Prism highlighting failed for language:", lang, e);
  }
}
function generateLineNumbers(){
  const lines = editor.value.split('\n').length;
  lineGutter.textContent = Array.from({length:lines},(_,i)=>i+1).join('\n');
}
function renderEditor(code){
  editor.value = code;
  highlightAndRender(code, currentLang);
  generateLineNumbers();
  updateStatus();
}
function updateStatus(){
  const pos = editor.selectionStart;
  const code = editor.value;
  const linesArr = code.substr(0,pos).split('\n');
  const langDisplay = $('#language-selector option:selected').text();
  // Updated status bar format to include Language
  statusEditor.textContent = `Lang: ${langDisplay} | Cursor: ${linesArr.length}:${linesArr[linesArr.length-1].length} | Lines: ${code.split('\n').length} | Chars: ${code.length}`;
}
function syncScroll(){
  $('.highlighting')[0].scrollTop = editor.scrollTop;
  $('.highlighting')[0].scrollLeft = editor.scrollLeft;
  lineGutter.scrollTop = editor.scrollTop;
}

// History
let historyStack=[], redoStack=[], MAX_HISTORY=400;
function pushHistory(){
  const code=editor.value;
  if(historyStack.length && historyStack[historyStack.length-1]===code) return;
  historyStack.push(code);
  if(historyStack.length>MAX_HISTORY) historyStack.shift();
  redoStack=[];
  updateStatus();
}
function undo(){ if(historyStack.length){ redoStack.push(editor.value); renderEditor(historyStack.pop()); } }
function redo(){ if(redoStack.length){ historyStack.push(editor.value); renderEditor(redoStack.pop()); } }

// Events
$('#editor').on('input propertychange', function() {
    pushHistory(); 
    highlightAndRender(editor.value, currentLang); 
    generateLineNumbers(); 
    updateStatus();
});
$('#editor').on('scroll', syncScroll);
$('#editor').on('keyup click', updateStatus);

// Language Selector Event Handler
$('#language-selector').on('change', function(){
    currentLang = $(this).val();
    // For Python, automatically switch to beautify to python
    if(currentLang === 'python') {
      $('#btn-beautify').off('click').click(()=>{ 
        editor.value=js_beautify(editor.value, { 
          indent_size:4, 
          space_in_empty_paren: true,
          end_with_newline: true,
          e4x: true // Treat Python as a block of code similar to JS beautify
        }); 
        renderEditor(editor.value); 
      });
    } else {
      // Revert beautify to standard JS/HTML/CSS for others
      $('#btn-beautify').off('click').click(()=>{ 
        editor.value=js_beautify(editor.value,{indent_size:4}); 
        renderEditor(editor.value); 
      });
    }
    highlightAndRender(editor.value, currentLang);
    updateStatus();
});


$('#btn-undo').click(undo);
$('#btn-redo').click(redo);

// Initial Beautify Handler (will be overwritten if language changes)
$('#btn-beautify').click(()=>{ 
  editor.value=js_beautify(editor.value,{indent_size:4}); 
  renderEditor(editor.value); 
});

$('#left-toggle').click(()=>{ gsap.to(leftPanel,{x:leftPanel.hasClass('open')?'-240px':'0px', duration:0.3}); leftPanel.toggleClass('open'); });

// Footer AI
$('#send-button').click(()=>{ 
    // Do not use alert(), use a modal or message box instead!
    console.log('AI Execution Stub: '+$('#prompt-input').val()); 
    // You'd replace the console.log with a custom notification here.
});
$('#prompt-input').keydown(e=>{ if((e.ctrlKey||e.metaKey)&&e.key==='Enter'){ $('#send-button').click(); } });

// Init
// Set initial language in the selector and trigger render
$('#language-selector').val(currentLang);
renderEditor(editor.value);
pushHistory();
</script>
</body>
</html>



